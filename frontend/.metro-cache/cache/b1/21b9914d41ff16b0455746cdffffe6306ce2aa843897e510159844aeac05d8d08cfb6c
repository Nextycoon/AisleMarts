{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"ranker\", {\n    enumerable: true,\n    get: function () {\n      return ranker;\n    }\n  });\n  Object.defineProperty(exports, \"ucb1Ranker\", {\n    enumerable: true,\n    get: function () {\n      return ucb1Ranker;\n    }\n  });\n  exports.applyRanking = applyRanking;\n  exports.createRankerContext = createRankerContext;\n  exports.trackRankerEvent = trackRankerEvent;\n  Object.defineProperty(exports, \"RANKER_CONFIG\", {\n    enumerable: true,\n    get: function () {\n      return RANKER_CONFIG;\n    }\n  });\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  /**\n   * P2 AI Recommendations: Ranker Hook System\n   * \n   * This provides a clean interface for story ranking algorithms.\n   * P1: Returns identity function (no ranking)  \n   * P2: Ready for UCB1 bandit integration with business constraints\n   */\n\n  // P1 Implementation: Identity function (preserves existing order)\n\n  // P1: Identity ranker - no reordering  \n  const ranker = (stories, context) => {\n    // For P1: return stories as-is (preserve existing backend order)\n    return stories;\n  };\n\n  // P2 Preview: UCB1 Bandit Algorithm (ready for activation)\n  const ucb1Ranker = (stories, context) => {\n    if (!context || stories.length <= 1) return stories;\n    const now = context.timestamp ?? Date.now();\n    const constraints = context.businessConstraints || {};\n    const totalViews = stories.reduce((sum, s) => sum + (s.engagement?.views ?? 0), 0);\n    return stories.map(story => {\n      const engagement = story.engagement || {\n        impressions: 1,\n        ctas: 0,\n        purchases: 0,\n        views: 0\n      };\n      const metadata = story.metadata || {\n        freshness: now,\n        commission_rate: 0.05,\n        repetition_penalty: 0,\n        creator_tier: \"unverified\"\n      };\n      const business = story.business || {};\n\n      // UCB1 Core: CTR + exploration bonus\n      const views = Math.max(engagement.views ?? engagement.impressions, 1);\n      const clicks = engagement.ctas;\n      const clickRate = clicks / views;\n      const exploration = Math.sqrt(2 * Math.log(Math.max(totalViews, 1)) / views);\n      const ucbScore = clickRate + 1.414 * exploration; // C = sqrt(2)\n\n      // Business Constraints & Boosts\n      const commissionBoost = metadata.commission_rate * (constraints.minCommissionRate || 1);\n      const freshnessBoost = Math.max(0, 1 - (now - metadata.freshness) / (24 * 60 * 60 * 1000)) * (constraints.freshnessBoost || 0.1);\n      const repetitionPenalty = metadata.repetition_penalty * (constraints.maxRepetition || 0.2);\n      const businessBoost = business.boost_priority || 0;\n      const sponsoredBoost = business.sponsored ? 0.05 : 0;\n\n      // Creator tier weights\n      const tierWeights = constraints.creatorTierWeights || {\n        gold: 0.1,\n        blue: 0.05,\n        grey: 0.02,\n        unverified: 0\n      };\n      const tierBoost = tierWeights[metadata.creator_tier] || 0;\n\n      // Final Score: UCB + λ*commission + β*freshness - γ*repetition + business\n      const finalScore = ucbScore + commissionBoost + freshnessBoost - repetitionPenalty + businessBoost + sponsoredBoost + tierBoost;\n      return {\n        ...story,\n        _score: finalScore,\n        _debug: {\n          ucbScore,\n          commissionBoost,\n          freshnessBoost,\n          repetitionPenalty\n        }\n      };\n    }).sort((a, b) => (b._score || 0) - (a._score || 0)).map(({\n      _score,\n      _debug,\n      ...story\n    }) => story);\n  };\n\n  // Utility: Apply active ranker to story feed\n  function applyRanking(stories, context) {\n    // P1: Use identity ranker\n    // P2: Switch to ucb1Ranker or server-side ranking\n    return ranker(stories, context);\n  }\n\n  // Utility: Create ranker context from user session\n  function createRankerContext(userId, sessionId, previousStories = [], businessConstraints = {}, userPreferences = {}) {\n    return {\n      userId,\n      sessionId,\n      previousStories,\n      timestamp: Date.now(),\n      businessConstraints,\n      userPreferences\n    };\n  }\n\n  // Utility: Track engagement for ranker feedback\n  function trackRankerEvent(storyId, eventType, context) {\n    // This will feed back into the UCB1 algorithm for online learning\n    // P2: Send to analytics backend for stats update\n    console.log(`[ranker:${eventType}] story=${storyId} session=${context?.sessionId}`);\n  }\n\n  // P2 Feature Flags (ready for gradual rollout)\n  const RANKER_CONFIG = {\n    enabled: _expoVirtualEnv.env.EXPO_PUBLIC_RANKER_ENABLED === \"1\",\n    algorithm: _expoVirtualEnv.env.EXPO_PUBLIC_RANKER_ALGORITHM || \"identity\",\n    // \"identity\", \"ucb1\", \"server\"\n    lookahead: parseInt(_expoVirtualEnv.env.EXPO_PUBLIC_LOOKAHEAD || \"3\"),\n    debugMode: _expoVirtualEnv.env.EXPO_PUBLIC_RANKER_DEBUG === \"1\"\n  };\n});","lineCount":142,"map":[[7,2,62,0,"Object"],[7,8,62,0],[7,9,62,0,"defineProperty"],[7,23,62,0],[7,24,62,0,"exports"],[7,31,62,0],[8,4,62,0,"enumerable"],[8,14,62,0],[9,4,62,0,"get"],[9,7,62,0],[9,18,62,0,"get"],[9,19,62,0],[10,6,62,0],[10,13,62,0,"ranker"],[10,19,62,0],[11,4,62,0],[12,2,62,0],[13,2,68,0,"Object"],[13,8,68,0],[13,9,68,0,"defineProperty"],[13,23,68,0],[13,24,68,0,"exports"],[13,31,68,0],[14,4,68,0,"enumerable"],[14,14,68,0],[15,4,68,0,"get"],[15,7,68,0],[15,18,68,0,"get"],[15,19,68,0],[16,6,68,0],[16,13,68,0,"ucb1Ranker"],[16,23,68,0],[17,4,68,0],[18,2,68,0],[19,2,109,0,"exports"],[19,9,109,0],[19,10,109,0,"applyRanking"],[19,22,109,0],[19,25,109,0,"applyRanking"],[19,37,109,0],[20,2,116,0,"exports"],[20,9,116,0],[20,10,116,0,"createRankerContext"],[20,29,116,0],[20,32,116,0,"createRankerContext"],[20,51,116,0],[21,2,134,0,"exports"],[21,9,134,0],[21,10,134,0,"trackRankerEvent"],[21,26,134,0],[21,29,134,0,"trackRankerEvent"],[21,45,134,0],[22,2,145,0,"Object"],[22,8,145,0],[22,9,145,0,"defineProperty"],[22,23,145,0],[22,24,145,0,"exports"],[22,31,145,0],[23,4,145,0,"enumerable"],[23,14,145,0],[24,4,145,0,"get"],[24,7,145,0],[24,18,145,0,"get"],[24,19,145,0],[25,6,145,0],[25,13,145,0,"RANKER_CONFIG"],[25,26,145,0],[26,4,145,0],[27,2,145,0],[28,2,150,2],[28,6,150,2,"_expoVirtualEnv"],[28,21,150,2],[28,24,150,2,"require"],[28,31,150,2],[28,32,150,2,"_dependencyMap"],[28,46,150,2],[29,2,1,0],[30,0,2,0],[31,0,3,0],[32,0,4,0],[33,0,5,0],[34,0,6,0],[35,0,7,0],[37,2,55,0],[39,2,61,0],[40,2,62,7],[40,8,62,13,"ranker"],[40,14,62,27],[40,17,62,30,"ranker"],[40,18,62,31,"stories"],[40,25,62,47],[40,27,62,49,"context"],[40,34,62,72],[40,39,62,77],[41,4,63,2],[42,4,64,2],[42,11,64,9,"stories"],[42,18,64,16],[43,2,65,0],[43,3,65,1],[45,2,67,0],[46,2,68,7],[46,8,68,13,"ucb1Ranker"],[46,18,68,31],[46,21,68,34,"ucb1Ranker"],[46,22,68,35,"stories"],[46,29,68,51],[46,31,68,53,"context"],[46,38,68,76],[46,43,68,81],[47,4,69,2],[47,8,69,6],[47,9,69,7,"context"],[47,16,69,14],[47,20,69,18,"stories"],[47,27,69,25],[47,28,69,26,"length"],[47,34,69,32],[47,38,69,36],[47,39,69,37],[47,41,69,39],[47,48,69,46,"stories"],[47,55,69,53],[48,4,71,2],[48,10,71,8,"now"],[48,13,71,11],[48,16,71,14,"context"],[48,23,71,21],[48,24,71,22,"timestamp"],[48,33,71,31],[48,37,71,35,"Date"],[48,41,71,39],[48,42,71,40,"now"],[48,45,71,43],[48,46,71,44],[48,47,71,45],[49,4,72,2],[49,10,72,8,"constraints"],[49,21,72,19],[49,24,72,22,"context"],[49,31,72,29],[49,32,72,30,"businessConstraints"],[49,51,72,49],[49,55,72,53],[49,56,72,54],[49,57,72,55],[50,4,73,2],[50,10,73,8,"totalViews"],[50,20,73,18],[50,23,73,21,"stories"],[50,30,73,28],[50,31,73,29,"reduce"],[50,37,73,35],[50,38,73,36],[50,39,73,37,"sum"],[50,42,73,40],[50,44,73,42,"s"],[50,45,73,43],[50,50,73,48,"sum"],[50,53,73,51],[50,57,73,55,"s"],[50,58,73,56],[50,59,73,57,"engagement"],[50,69,73,67],[50,71,73,69,"views"],[50,76,73,74],[50,80,73,78],[50,81,73,79],[50,82,73,80],[50,84,73,82],[50,85,73,83],[50,86,73,84],[51,4,75,2],[51,11,75,9,"stories"],[51,18,75,16],[51,19,76,5,"map"],[51,22,76,8],[51,23,76,9,"story"],[51,28,76,14],[51,32,76,18],[52,6,77,6],[52,12,77,12,"engagement"],[52,22,77,22],[52,25,77,25,"story"],[52,30,77,30],[52,31,77,31,"engagement"],[52,41,77,41],[52,45,77,45],[53,8,77,47,"impressions"],[53,19,77,58],[53,21,77,60],[53,22,77,61],[54,8,77,63,"ctas"],[54,12,77,67],[54,14,77,69],[54,15,77,70],[55,8,77,72,"purchases"],[55,17,77,81],[55,19,77,83],[55,20,77,84],[56,8,77,86,"views"],[56,13,77,91],[56,15,77,93],[57,6,77,95],[57,7,77,96],[58,6,78,6],[58,12,78,12,"metadata"],[58,20,78,20],[58,23,78,23,"story"],[58,28,78,28],[58,29,78,29,"metadata"],[58,37,78,37],[58,41,78,41],[59,8,78,43,"freshness"],[59,17,78,52],[59,19,78,54,"now"],[59,22,78,57],[60,8,78,59,"commission_rate"],[60,23,78,74],[60,25,78,76],[60,29,78,80],[61,8,78,82,"repetition_penalty"],[61,26,78,100],[61,28,78,102],[61,29,78,103],[62,8,78,105,"creator_tier"],[62,20,78,117],[62,22,78,119],[63,6,78,132],[63,7,78,133],[64,6,79,6],[64,12,79,12,"business"],[64,20,79,20],[64,23,79,23,"story"],[64,28,79,28],[64,29,79,29,"business"],[64,37,79,37],[64,41,79,41],[64,42,79,42],[64,43,79,43],[66,6,81,6],[67,6,82,6],[67,12,82,12,"views"],[67,17,82,17],[67,20,82,20,"Math"],[67,24,82,24],[67,25,82,25,"max"],[67,28,82,28],[67,29,82,29,"engagement"],[67,39,82,39],[67,40,82,40,"views"],[67,45,82,45],[67,49,82,49,"engagement"],[67,59,82,59],[67,60,82,60,"impressions"],[67,71,82,71],[67,73,82,73],[67,74,82,74],[67,75,82,75],[68,6,83,6],[68,12,83,12,"clicks"],[68,18,83,18],[68,21,83,21,"engagement"],[68,31,83,31],[68,32,83,32,"ctas"],[68,36,83,36],[69,6,84,6],[69,12,84,12,"clickRate"],[69,21,84,21],[69,24,84,24,"clicks"],[69,30,84,30],[69,33,84,33,"views"],[69,38,84,38],[70,6,85,6],[70,12,85,12,"exploration"],[70,23,85,23],[70,26,85,26,"Math"],[70,30,85,30],[70,31,85,31,"sqrt"],[70,35,85,35],[70,36,85,36],[70,37,85,37],[70,40,85,40,"Math"],[70,44,85,44],[70,45,85,45,"log"],[70,48,85,48],[70,49,85,49,"Math"],[70,53,85,53],[70,54,85,54,"max"],[70,57,85,57],[70,58,85,58,"totalViews"],[70,68,85,68],[70,70,85,70],[70,71,85,71],[70,72,85,72],[70,73,85,73],[70,76,85,76,"views"],[70,81,85,81],[70,82,85,82],[71,6,86,6],[71,12,86,12,"ucbScore"],[71,20,86,20],[71,23,86,23,"clickRate"],[71,32,86,32],[71,35,86,36],[71,40,86,41],[71,43,86,44,"exploration"],[71,54,86,56],[71,55,86,57],[71,56,86,58],[73,6,88,6],[74,6,89,6],[74,12,89,12,"commissionBoost"],[74,27,89,27],[74,30,89,30,"metadata"],[74,38,89,38],[74,39,89,39,"commission_rate"],[74,54,89,54],[74,58,89,58,"constraints"],[74,69,89,69],[74,70,89,70,"minCommissionRate"],[74,87,89,87],[74,91,89,91],[74,92,89,92],[74,93,89,93],[75,6,90,6],[75,12,90,12,"freshnessBoost"],[75,26,90,26],[75,29,90,29,"Math"],[75,33,90,33],[75,34,90,34,"max"],[75,37,90,37],[75,38,90,38],[75,39,90,39],[75,41,90,41],[75,42,90,42],[75,45,90,45],[75,46,90,46,"now"],[75,49,90,49],[75,52,90,52,"metadata"],[75,60,90,60],[75,61,90,61,"freshness"],[75,70,90,70],[75,75,90,75],[75,77,90,77],[75,80,90,80],[75,82,90,82],[75,85,90,85],[75,87,90,87],[75,90,90,90],[75,94,90,94],[75,95,90,95],[75,96,90,96],[75,100,90,100,"constraints"],[75,111,90,111],[75,112,90,112,"freshnessBoost"],[75,126,90,126],[75,130,90,130],[75,133,90,133],[75,134,90,134],[76,6,91,6],[76,12,91,12,"repetitionPenalty"],[76,29,91,29],[76,32,91,32,"metadata"],[76,40,91,40],[76,41,91,41,"repetition_penalty"],[76,59,91,59],[76,63,91,63,"constraints"],[76,74,91,74],[76,75,91,75,"maxRepetition"],[76,88,91,88],[76,92,91,92],[76,95,91,95],[76,96,91,96],[77,6,92,6],[77,12,92,12,"businessBoost"],[77,25,92,25],[77,28,92,28,"business"],[77,36,92,36],[77,37,92,37,"boost_priority"],[77,51,92,51],[77,55,92,55],[77,56,92,56],[78,6,93,6],[78,12,93,12,"sponsoredBoost"],[78,26,93,26],[78,29,93,29,"business"],[78,37,93,37],[78,38,93,38,"sponsored"],[78,47,93,47],[78,50,93,50],[78,54,93,54],[78,57,93,57],[78,58,93,58],[80,6,95,6],[81,6,96,6],[81,12,96,12,"tierWeights"],[81,23,96,23],[81,26,96,26,"constraints"],[81,37,96,37],[81,38,96,38,"creatorTierWeights"],[81,56,96,56],[81,60,96,60],[82,8,96,62,"gold"],[82,12,96,66],[82,14,96,68],[82,17,96,71],[83,8,96,73,"blue"],[83,12,96,77],[83,14,96,79],[83,18,96,83],[84,8,96,85,"grey"],[84,12,96,89],[84,14,96,91],[84,18,96,95],[85,8,96,97,"unverified"],[85,18,96,107],[85,20,96,109],[86,6,96,111],[86,7,96,112],[87,6,97,6],[87,12,97,12,"tierBoost"],[87,21,97,21],[87,24,97,24,"tierWeights"],[87,35,97,35],[87,36,97,36,"metadata"],[87,44,97,44],[87,45,97,45,"creator_tier"],[87,57,97,57],[87,58,97,58],[87,62,97,62],[87,63,97,63],[89,6,99,6],[90,6,100,6],[90,12,100,12,"finalScore"],[90,22,100,22],[90,25,100,25,"ucbScore"],[90,33,100,33],[90,36,100,36,"commissionBoost"],[90,51,100,51],[90,54,100,54,"freshnessBoost"],[90,68,100,68],[90,71,100,71,"repetitionPenalty"],[90,88,100,88],[90,91,100,91,"businessBoost"],[90,104,100,104],[90,107,100,107,"sponsoredBoost"],[90,121,100,121],[90,124,100,124,"tierBoost"],[90,133,100,133],[91,6,102,6],[91,13,102,13],[92,8,102,15],[92,11,102,18,"story"],[92,16,102,23],[93,8,102,25,"_score"],[93,14,102,31],[93,16,102,33,"finalScore"],[93,26,102,43],[94,8,102,45,"_debug"],[94,14,102,51],[94,16,102,53],[95,10,102,55,"ucbScore"],[95,18,102,63],[96,10,102,65,"commissionBoost"],[96,25,102,80],[97,10,102,82,"freshnessBoost"],[97,24,102,96],[98,10,102,98,"repetitionPenalty"],[99,8,102,116],[100,6,102,118],[100,7,102,119],[101,4,103,4],[101,5,103,5],[101,6,103,6],[101,7,104,5,"sort"],[101,11,104,9],[101,12,104,10],[101,13,104,11,"a"],[101,14,104,12],[101,16,104,14,"b"],[101,17,104,15],[101,22,104,20],[101,23,104,21,"b"],[101,24,104,22],[101,25,104,23,"_score"],[101,31,104,29],[101,35,104,33],[101,36,104,34],[101,41,104,39,"a"],[101,42,104,40],[101,43,104,41,"_score"],[101,49,104,47],[101,53,104,51],[101,54,104,52],[101,55,104,53],[101,56,104,54],[101,57,105,5,"map"],[101,60,105,8],[101,61,105,9],[101,62,105,10],[102,6,105,12,"_score"],[102,12,105,18],[103,6,105,20,"_debug"],[103,12,105,26],[104,6,105,28],[104,9,105,31,"story"],[105,4,105,37],[105,5,105,38],[105,10,105,43,"story"],[105,15,105,48],[105,16,105,49],[106,2,106,0],[106,3,106,1],[108,2,108,0],[109,2,109,7],[109,11,109,16,"applyRanking"],[109,23,109,28,"applyRanking"],[109,24,109,29,"stories"],[109,31,109,45],[109,33,109,47,"context"],[109,40,109,70],[109,42,109,81],[110,4,110,2],[111,4,111,2],[112,4,112,2],[112,11,112,9,"ranker"],[112,17,112,15],[112,18,112,16,"stories"],[112,25,112,23],[112,27,112,25,"context"],[112,34,112,32],[112,35,112,33],[113,2,113,0],[115,2,115,0],[116,2,116,7],[116,11,116,16,"createRankerContext"],[116,30,116,35,"createRankerContext"],[116,31,117,2,"userId"],[116,37,117,16],[116,39,118,2,"sessionId"],[116,48,118,19],[116,50,119,2,"previousStories"],[116,65,119,27],[116,68,119,30],[116,70,119,32],[116,72,120,2,"businessConstraints"],[116,91,120,21],[116,94,120,24],[116,95,120,25],[116,96,120,26],[116,98,121,2,"userPreferences"],[116,113,121,17],[116,116,121,20],[116,117,121,21],[116,118,121,22],[116,120,122,17],[117,4,123,2],[117,11,123,9],[118,6,124,4,"userId"],[118,12,124,10],[119,6,125,4,"sessionId"],[119,15,125,13],[120,6,126,4,"previousStories"],[120,21,126,19],[121,6,127,4,"timestamp"],[121,15,127,13],[121,17,127,15,"Date"],[121,21,127,19],[121,22,127,20,"now"],[121,25,127,23],[121,26,127,24],[121,27,127,25],[122,6,128,4,"businessConstraints"],[122,25,128,23],[123,6,129,4,"userPreferences"],[124,4,130,2],[124,5,130,3],[125,2,131,0],[127,2,133,0],[128,2,134,7],[128,11,134,16,"trackRankerEvent"],[128,27,134,32,"trackRankerEvent"],[128,28,135,2,"storyId"],[128,35,135,17],[128,37,136,2,"eventType"],[128,46,136,56],[128,48,137,2,"context"],[128,55,137,25],[128,57,138,2],[129,4,139,2],[130,4,140,2],[131,4,141,2,"console"],[131,11,141,9],[131,12,141,10,"log"],[131,15,141,13],[131,16,141,14],[131,27,141,25,"eventType"],[131,36,141,34],[131,47,141,45,"storyId"],[131,54,141,52],[131,66,141,64,"context"],[131,73,141,71],[131,75,141,73,"sessionId"],[131,84,141,82],[131,86,141,84],[131,87,141,85],[132,2,142,0],[134,2,144,0],[135,2,145,7],[135,8,145,13,"RANKER_CONFIG"],[135,21,145,26],[135,24,145,29],[136,4,146,2,"enabled"],[136,11,146,9],[136,13,146,11,"_expoVirtualEnv"],[136,28,146,11],[136,29,146,11,"env"],[136,32,146,11],[136,33,146,11,"EXPO_PUBLIC_RANKER_ENABLED"],[136,59,146,11],[136,64,146,54],[136,67,146,57],[137,4,147,2,"algorithm"],[137,13,147,11],[137,15,147,13,"_expoVirtualEnv"],[137,30,147,13],[137,31,147,13,"env"],[137,34,147,13],[137,35,147,13,"EXPO_PUBLIC_RANKER_ALGORITHM"],[137,63,147,13],[137,67,147,57],[137,77,147,67],[138,4,147,69],[139,4,148,2,"lookahead"],[139,13,148,11],[139,15,148,13,"parseInt"],[139,23,148,21],[139,24,148,22,"_expoVirtualEnv"],[139,39,148,22],[139,40,148,22,"env"],[139,43,148,22],[139,44,148,22,"EXPO_PUBLIC_LOOKAHEAD"],[139,65,148,22],[139,69,148,59],[139,72,148,62],[139,73,148,63],[140,4,149,2,"debugMode"],[140,13,149,11],[140,15,149,13,"_expoVirtualEnv"],[140,30,149,13],[140,31,149,13,"env"],[140,34,149,13],[140,35,149,13,"EXPO_PUBLIC_RANKER_DEBUG"],[140,59,149,13],[140,64,149,54],[141,2,150,0],[141,3,150,1],[142,0,150,2],[142,3]],"functionMap":{"names":["<global>","ranker","ucb1Ranker","stories.reduce$argument_0","stories.map$argument_0","stories.map.sort$argument_0","stories.map.sort.map$argument_0","applyRanking","createRankerContext","trackRankerEvent"],"mappings":"AAA;8BC6D;CDG;kCEG;oCCK,4CD;SEG;KF2B;UGC,2CH;SIC,uCJ;CFC;OOG;CPI;OQG;CRe;OSG;CTQ"},"hasCjsExports":false},"type":"js/module"}]}