{"dependencies":[{"name":"react-native-web/dist/exports/Image","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"h9Yjx6LR7umCdPP226caWyLdUPo=","exportNames":["*"],"imports":1}},{"name":"expo-asset","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":38},"end":{"line":2,"column":35,"index":73}}],"key":"ZXJFWHziJpBZf3W7vl00wXf6fd8=","exportNames":["*"],"imports":1}},{"name":"./LRUMediaCache","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":74},"end":{"line":3,"column":48,"index":122}}],"key":"AKbXoy/C33oPqfy8xlgc1zZu7KU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"PrefetchCoordinator\", {\n    enumerable: true,\n    get: function () {\n      return PrefetchCoordinator;\n    }\n  });\n  var _reactNativeWebDistExportsImage = require(_dependencyMap[0], \"react-native-web/dist/exports/Image\");\n  var Image = _interopDefault(_reactNativeWebDistExportsImage);\n  var _expoAsset = require(_dependencyMap[1], \"expo-asset\");\n  var _LRUMediaCache = require(_dependencyMap[2], \"./LRUMediaCache\");\n  class PrefetchCoordinator {\n    idx = 0;\n    constructor(stories, lookahead = 3, cache = new _LRUMediaCache.LRUMediaCache()) {\n      this.stories = stories;\n      this.lookahead = lookahead;\n      this.cache = cache;\n    }\n    attachGlobal() {\n      globalThis.__prefetch = this;\n      this.cache = this.cache;\n    }\n    updateStories(stories) {\n      this.stories = stories;\n      this.kick();\n    }\n    focus(i) {\n      this.idx = i;\n      this.kick();\n    }\n    async prefetch(url, type) {\n      if (this.cache.has(url)) return;\n      try {\n        if (type === \"image\") {\n          await Image.default.prefetch(url);\n          this.cache.put(url);\n        } else if (type === \"video\") {\n          // Video preloading with expo-asset (file system cache)\n          const asset = _expoAsset.Asset.fromURI(url);\n          await asset.downloadAsync();\n          this.cache.put(url, asset.downloaded ? asset.filesize ?? 1_500_000 : 1_500_000);\n        }\n      } catch (error) {\n        // Silent fail for prefetch - don't block user experience\n        console.warn(`Prefetch failed for ${type} ${url}:`, error);\n      }\n    }\n    async kick() {\n      for (let d = 1; d <= this.lookahead; d++) {\n        const s = this.stories[this.idx + d];\n        if (!s) continue;\n        await this.prefetch(s.mediaUrl, s.type);\n      }\n    }\n\n    // P1b: Get prefetch statistics for performance monitoring\n    getStats() {\n      const usage = this.cache.usageMB();\n      return {\n        cacheUsageMB: usage,\n        lookahead: this.lookahead,\n        currentIndex: this.idx,\n        totalStories: this.stories.length\n      };\n    }\n\n    // P1b: Dynamic lookahead adjustment based on performance\n    adjustLookahead(newLookahead) {\n      this.lookahead = Math.max(1, Math.min(5, newLookahead));\n    }\n  }\n});","lineCount":82,"map":[[12,2,7,0,"Object"],[12,8,7,0],[12,9,7,0,"defineProperty"],[12,23,7,0],[12,24,7,0,"exports"],[12,31,7,0],[13,4,7,0,"enumerable"],[13,14,7,0],[14,4,7,0,"get"],[14,7,7,0],[14,18,7,0,"get"],[14,19,7,0],[15,6,7,0],[15,13,7,0,"PrefetchCoordinator"],[15,32,7,0],[16,4,7,0],[17,2,7,0],[18,2,55,1],[18,6,55,1,"_reactNativeWebDistExportsImage"],[18,37,55,1],[18,40,55,1,"require"],[18,47,55,1],[18,48,55,1,"_dependencyMap"],[18,62,55,1],[19,2,55,1],[19,6,55,1,"Image"],[19,11,55,1],[19,14,55,1,"_interopDefault"],[19,29,55,1],[19,30,55,1,"_reactNativeWebDistExportsImage"],[19,61,55,1],[20,2,2,0],[20,6,2,0,"_expoAsset"],[20,16,2,0],[20,19,2,0,"require"],[20,26,2,0],[20,27,2,0,"_dependencyMap"],[20,41,2,0],[21,2,3,0],[21,6,3,0,"_LRUMediaCache"],[21,20,3,0],[21,23,3,0,"require"],[21,30,3,0],[21,31,3,0,"_dependencyMap"],[21,45,3,0],[22,2,7,7],[22,8,7,13,"PrefetchCoordinator"],[22,27,7,32],[22,28,7,33],[23,4,8,10,"idx"],[23,7,8,13],[23,10,8,16],[23,11,8,17],[24,4,9,2,"constructor"],[24,15,9,13,"constructor"],[24,16,9,22,"stories"],[24,23,9,38],[24,25,9,48,"lookahead"],[24,34,9,57],[24,37,9,60],[24,38,9,61],[24,40,9,71,"cache"],[24,45,9,76],[24,48,9,79],[24,52,9,83,"LRUMediaCache"],[24,66,9,96],[24,67,9,96,"LRUMediaCache"],[24,80,9,96],[24,81,9,97],[24,82,9,98],[24,84,9,100],[25,6,9,100],[25,11,9,22,"stories"],[25,18,9,38],[25,21,9,22,"stories"],[25,28,9,38],[26,6,9,38],[26,11,9,48,"lookahead"],[26,20,9,57],[26,23,9,48,"lookahead"],[26,32,9,57],[27,6,9,57],[27,11,9,71,"cache"],[27,16,9,76],[27,19,9,71,"cache"],[27,24,9,76],[28,4,9,101],[29,4,10,2,"attachGlobal"],[29,16,10,14,"attachGlobal"],[29,17,10,14],[29,19,10,17],[30,6,10,20,"globalThis"],[30,16,10,30],[30,17,10,39,"__prefetch"],[30,27,10,49],[30,30,10,52],[30,34,10,56],[31,6,10,59],[31,10,10,63],[31,11,10,72,"cache"],[31,16,10,77],[31,19,10,80],[31,23,10,84],[31,24,10,85,"cache"],[31,29,10,90],[32,4,10,92],[33,4,11,2,"updateStories"],[33,17,11,15,"updateStories"],[33,18,11,16,"stories"],[33,25,11,32],[33,27,11,34],[34,6,11,36],[34,10,11,40],[34,11,11,41,"stories"],[34,18,11,48],[34,21,11,51,"stories"],[34,28,11,58],[35,6,11,60],[35,10,11,64],[35,11,11,65,"kick"],[35,15,11,69],[35,16,11,70],[35,17,11,71],[36,4,11,73],[37,4,12,2,"focus"],[37,9,12,7,"focus"],[37,10,12,8,"i"],[37,11,12,17],[37,13,12,19],[38,6,12,21],[38,10,12,25],[38,11,12,26,"idx"],[38,14,12,29],[38,17,12,32,"i"],[38,18,12,33],[39,6,12,35],[39,10,12,39],[39,11,12,40,"kick"],[39,15,12,44],[39,16,12,45],[39,17,12,46],[40,4,12,48],[41,4,14,2],[41,10,14,16,"prefetch"],[41,18,14,24,"prefetch"],[41,19,14,25,"url"],[41,22,14,36],[41,24,14,38,"type"],[41,28,14,57],[41,30,14,59],[42,6,15,4],[42,10,15,8],[42,14,15,12],[42,15,15,13,"cache"],[42,20,15,18],[42,21,15,19,"has"],[42,24,15,22],[42,25,15,23,"url"],[42,28,15,26],[42,29,15,27],[42,31,15,29],[43,6,16,4],[43,10,16,8],[44,8,17,6],[44,12,17,10,"type"],[44,16,17,14],[44,21,17,19],[44,28,17,26],[44,30,17,28],[45,10,18,8],[45,16,18,14,"Image"],[45,21,18,19],[45,22,18,19,"default"],[45,29,18,19],[45,30,18,20,"prefetch"],[45,38,18,28],[45,39,18,29,"url"],[45,42,18,32],[45,43,18,33],[46,10,19,8],[46,14,19,12],[46,15,19,13,"cache"],[46,20,19,18],[46,21,19,19,"put"],[46,24,19,22],[46,25,19,23,"url"],[46,28,19,26],[46,29,19,27],[47,8,20,6],[47,9,20,7],[47,15,20,13],[47,19,20,17,"type"],[47,23,20,21],[47,28,20,26],[47,35,20,33],[47,37,20,35],[48,10,21,8],[49,10,22,8],[49,16,22,14,"asset"],[49,21,22,19],[49,24,22,22,"Asset"],[49,34,22,27],[49,35,22,27,"Asset"],[49,40,22,27],[49,41,22,28,"fromURI"],[49,48,22,35],[49,49,22,36,"url"],[49,52,22,39],[49,53,22,40],[50,10,23,8],[50,16,23,14,"asset"],[50,21,23,19],[50,22,23,20,"downloadAsync"],[50,35,23,33],[50,36,23,34],[50,37,23,35],[51,10,24,8],[51,14,24,12],[51,15,24,13,"cache"],[51,20,24,18],[51,21,24,19,"put"],[51,24,24,22],[51,25,24,23,"url"],[51,28,24,26],[51,30,24,28,"asset"],[51,35,24,33],[51,36,24,34,"downloaded"],[51,46,24,44],[51,49,24,47,"asset"],[51,54,24,52],[51,55,24,53,"filesize"],[51,63,24,61],[51,67,24,65],[51,76,24,74],[51,79,24,77],[51,88,24,86],[51,89,24,87],[52,8,25,6],[53,6,26,4],[53,7,26,5],[53,8,26,6],[53,15,26,13,"error"],[53,20,26,18],[53,22,26,20],[54,8,27,6],[55,8,28,6,"console"],[55,15,28,13],[55,16,28,14,"warn"],[55,20,28,18],[55,21,28,19],[55,44,28,42,"type"],[55,48,28,46],[55,52,28,50,"url"],[55,55,28,53],[55,58,28,56],[55,60,28,58,"error"],[55,65,28,63],[55,66,28,64],[56,6,29,4],[57,4,30,2],[58,4,32,2],[58,10,32,16,"kick"],[58,14,32,20,"kick"],[58,15,32,20],[58,17,32,23],[59,6,33,4],[59,11,33,9],[59,15,33,13,"d"],[59,16,33,14],[59,19,33,17],[59,20,33,18],[59,22,33,20,"d"],[59,23,33,21],[59,27,33,25],[59,31,33,29],[59,32,33,30,"lookahead"],[59,41,33,39],[59,43,33,41,"d"],[59,44,33,42],[59,46,33,44],[59,48,33,46],[60,8,34,6],[60,14,34,12,"s"],[60,15,34,13],[60,18,34,16],[60,22,34,20],[60,23,34,21,"stories"],[60,30,34,28],[60,31,34,29],[60,35,34,33],[60,36,34,34,"idx"],[60,39,34,37],[60,42,34,40,"d"],[60,43,34,41],[60,44,34,42],[61,8,35,6],[61,12,35,10],[61,13,35,11,"s"],[61,14,35,12],[61,16,35,14],[62,8,36,6],[62,14,36,12],[62,18,36,16],[62,19,36,17,"prefetch"],[62,27,36,25],[62,28,36,26,"s"],[62,29,36,27],[62,30,36,28,"mediaUrl"],[62,38,36,36],[62,40,36,38,"s"],[62,41,36,39],[62,42,36,40,"type"],[62,46,36,44],[62,47,36,45],[63,6,37,4],[64,4,38,2],[66,4,40,2],[67,4,41,2,"getStats"],[67,12,41,10,"getStats"],[67,13,41,10],[67,15,41,13],[68,6,42,4],[68,12,42,10,"usage"],[68,17,42,15],[68,20,42,18],[68,24,42,22],[68,25,42,23,"cache"],[68,30,42,28],[68,31,42,29,"usageMB"],[68,38,42,36],[68,39,42,37],[68,40,42,38],[69,6,43,4],[69,13,43,11],[70,8,44,6,"cacheUsageMB"],[70,20,44,18],[70,22,44,20,"usage"],[70,27,44,25],[71,8,45,6,"lookahead"],[71,17,45,15],[71,19,45,17],[71,23,45,21],[71,24,45,22,"lookahead"],[71,33,45,31],[72,8,46,6,"currentIndex"],[72,20,46,18],[72,22,46,20],[72,26,46,24],[72,27,46,25,"idx"],[72,30,46,28],[73,8,47,6,"totalStories"],[73,20,47,18],[73,22,47,20],[73,26,47,24],[73,27,47,25,"stories"],[73,34,47,32],[73,35,47,33,"length"],[74,6,48,4],[74,7,48,5],[75,4,49,2],[77,4,51,2],[78,4,52,2,"adjustLookahead"],[78,19,52,17,"adjustLookahead"],[78,20,52,18,"newLookahead"],[78,32,52,38],[78,34,52,40],[79,6,53,4],[79,10,53,8],[79,11,53,9,"lookahead"],[79,20,53,18],[79,23,53,21,"Math"],[79,27,53,25],[79,28,53,26,"max"],[79,31,53,29],[79,32,53,30],[79,33,53,31],[79,35,53,33,"Math"],[79,39,53,37],[79,40,53,38,"min"],[79,43,53,41],[79,44,53,42],[79,45,53,43],[79,47,53,45,"newLookahead"],[79,59,53,57],[79,60,53,58],[79,61,53,59],[80,4,54,2],[81,2,55,0],[82,0,55,1],[82,3]],"functionMap":{"names":["<global>","PrefetchCoordinator","constructor","attachGlobal","updateStories","focus","prefetch","kick","getStats","adjustLookahead"],"mappings":"AAA;OCM;ECE,oGD;EEC,2FF;EGC,wEH;EIC,+CJ;EKE;GLgB;EME;GNM;EOG;GPQ;EQG;GRE"},"hasCjsExports":false},"type":"js/module"}]}