{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"ranker\", {\n    enumerable: true,\n    get: function () {\n      return ranker;\n    }\n  });\n  Object.defineProperty(exports, \"ucb1Ranker\", {\n    enumerable: true,\n    get: function () {\n      return ucb1Ranker;\n    }\n  });\n  exports.applyRanking = applyRanking;\n  exports.createRankerContext = createRankerContext;\n  exports.trackRankerEvent = trackRankerEvent;\n  Object.defineProperty(exports, \"RANKER_CONFIG\", {\n    enumerable: true,\n    get: function () {\n      return RANKER_CONFIG;\n    }\n  });\n  /**\n   * P2 AI Recommendations: Ranker Hook System\n   * \n   * This provides a clean interface for story ranking algorithms.\n   * P1: Returns identity function (no ranking)  \n   * P2: Ready for UCB1 bandit integration with business constraints\n   */\n\n  // P1 Implementation: Identity function (preserves existing order)\n\n  // P1: Identity ranker - no reordering  \n  const ranker = (stories, context) => {\n    // For P1: return stories as-is (preserve existing backend order)\n    return stories;\n  };\n\n  // P2 Preview: UCB1 Bandit Algorithm (ready for activation)\n  const ucb1Ranker = (stories, context) => {\n    if (!context || stories.length <= 1) return stories;\n    const now = context.timestamp ?? Date.now();\n    const constraints = context.businessConstraints || {};\n    const totalViews = stories.reduce((sum, s) => sum + (s.engagement?.views ?? 0), 0);\n    return stories.map(story => {\n      const engagement = story.engagement || {\n        impressions: 1,\n        ctas: 0,\n        purchases: 0,\n        views: 0\n      };\n      const metadata = story.metadata || {\n        freshness: now,\n        commission_rate: 0.05,\n        repetition_penalty: 0,\n        creator_tier: \"unverified\"\n      };\n      const business = story.business || {};\n\n      // UCB1 Core: CTR + exploration bonus\n      const views = Math.max(engagement.views ?? engagement.impressions, 1);\n      const clicks = engagement.ctas;\n      const clickRate = clicks / views;\n      const exploration = Math.sqrt(2 * Math.log(Math.max(totalViews, 1)) / views);\n      const ucbScore = clickRate + 1.414 * exploration; // C = sqrt(2)\n\n      // Business Constraints & Boosts\n      const commissionBoost = metadata.commission_rate * (constraints.minCommissionRate || 1);\n      const freshnessBoost = Math.max(0, 1 - (now - metadata.freshness) / (24 * 60 * 60 * 1000)) * (constraints.freshnessBoost || 0.1);\n      const repetitionPenalty = metadata.repetition_penalty * (constraints.maxRepetition || 0.2);\n      const businessBoost = business.boost_priority || 0;\n      const sponsoredBoost = business.sponsored ? 0.05 : 0;\n\n      // Creator tier weights\n      const tierWeights = constraints.creatorTierWeights || {\n        gold: 0.1,\n        blue: 0.05,\n        grey: 0.02,\n        unverified: 0\n      };\n      const tierBoost = tierWeights[metadata.creator_tier] || 0;\n\n      // Final Score: UCB + λ*commission + β*freshness - γ*repetition + business\n      const finalScore = ucbScore + commissionBoost + freshnessBoost - repetitionPenalty + businessBoost + sponsoredBoost + tierBoost;\n      return {\n        ...story,\n        _score: finalScore,\n        _debug: {\n          ucbScore,\n          commissionBoost,\n          freshnessBoost,\n          repetitionPenalty\n        }\n      };\n    }).sort((a, b) => (b._score || 0) - (a._score || 0)).map(({\n      _score,\n      _debug,\n      ...story\n    }) => story);\n  };\n\n  // Utility: Apply active ranker to story feed\n  function applyRanking(stories, context) {\n    // P1: Use identity ranker\n    // P2: Switch to ucb1Ranker or server-side ranking\n    return ranker(stories, context);\n  }\n\n  // Utility: Create ranker context from user session\n  function createRankerContext(userId, sessionId, previousStories = [], businessConstraints = {}, userPreferences = {}) {\n    return {\n      userId,\n      sessionId,\n      previousStories,\n      timestamp: Date.now(),\n      businessConstraints,\n      userPreferences\n    };\n  }\n\n  // Utility: Track engagement for ranker feedback\n  function trackRankerEvent(storyId, eventType, context) {\n    // This will feed back into the UCB1 algorithm for online learning\n    // P2: Send to analytics backend for stats update\n    console.log(`[ranker:${eventType}] story=${storyId} session=${context?.sessionId}`);\n  }\n\n  // P2 Feature Flags (ready for gradual rollout)\n  const RANKER_CONFIG = {\n    enabled: process.env.EXPO_PUBLIC_RANKER_ENABLED === \"1\",\n    algorithm: process.env.EXPO_PUBLIC_RANKER_ALGORITHM || \"identity\",\n    // \"identity\", \"ucb1\", \"server\"\n    lookahead: parseInt(process.env.EXPO_PUBLIC_LOOKAHEAD || \"3\"),\n    debugMode: process.env.EXPO_PUBLIC_RANKER_DEBUG === \"1\"\n  };\n});","lineCount":141,"map":[[7,2,62,0,"Object"],[7,8,62,0],[7,9,62,0,"defineProperty"],[7,23,62,0],[7,24,62,0,"exports"],[7,31,62,0],[8,4,62,0,"enumerable"],[8,14,62,0],[9,4,62,0,"get"],[9,7,62,0],[9,18,62,0,"get"],[9,19,62,0],[10,6,62,0],[10,13,62,0,"ranker"],[10,19,62,0],[11,4,62,0],[12,2,62,0],[13,2,68,0,"Object"],[13,8,68,0],[13,9,68,0,"defineProperty"],[13,23,68,0],[13,24,68,0,"exports"],[13,31,68,0],[14,4,68,0,"enumerable"],[14,14,68,0],[15,4,68,0,"get"],[15,7,68,0],[15,18,68,0,"get"],[15,19,68,0],[16,6,68,0],[16,13,68,0,"ucb1Ranker"],[16,23,68,0],[17,4,68,0],[18,2,68,0],[19,2,109,0,"exports"],[19,9,109,0],[19,10,109,0,"applyRanking"],[19,22,109,0],[19,25,109,0,"applyRanking"],[19,37,109,0],[20,2,116,0,"exports"],[20,9,116,0],[20,10,116,0,"createRankerContext"],[20,29,116,0],[20,32,116,0,"createRankerContext"],[20,51,116,0],[21,2,134,0,"exports"],[21,9,134,0],[21,10,134,0,"trackRankerEvent"],[21,26,134,0],[21,29,134,0,"trackRankerEvent"],[21,45,134,0],[22,2,145,0,"Object"],[22,8,145,0],[22,9,145,0,"defineProperty"],[22,23,145,0],[22,24,145,0,"exports"],[22,31,145,0],[23,4,145,0,"enumerable"],[23,14,145,0],[24,4,145,0,"get"],[24,7,145,0],[24,18,145,0,"get"],[24,19,145,0],[25,6,145,0],[25,13,145,0,"RANKER_CONFIG"],[25,26,145,0],[26,4,145,0],[27,2,145,0],[28,2,1,0],[29,0,2,0],[30,0,3,0],[31,0,4,0],[32,0,5,0],[33,0,6,0],[34,0,7,0],[36,2,55,0],[38,2,61,0],[39,2,62,7],[39,8,62,13,"ranker"],[39,14,62,27],[39,17,62,30,"ranker"],[39,18,62,31,"stories"],[39,25,62,47],[39,27,62,49,"context"],[39,34,62,72],[39,39,62,77],[40,4,63,2],[41,4,64,2],[41,11,64,9,"stories"],[41,18,64,16],[42,2,65,0],[42,3,65,1],[44,2,67,0],[45,2,68,7],[45,8,68,13,"ucb1Ranker"],[45,18,68,31],[45,21,68,34,"ucb1Ranker"],[45,22,68,35,"stories"],[45,29,68,51],[45,31,68,53,"context"],[45,38,68,76],[45,43,68,81],[46,4,69,2],[46,8,69,6],[46,9,69,7,"context"],[46,16,69,14],[46,20,69,18,"stories"],[46,27,69,25],[46,28,69,26,"length"],[46,34,69,32],[46,38,69,36],[46,39,69,37],[46,41,69,39],[46,48,69,46,"stories"],[46,55,69,53],[47,4,71,2],[47,10,71,8,"now"],[47,13,71,11],[47,16,71,14,"context"],[47,23,71,21],[47,24,71,22,"timestamp"],[47,33,71,31],[47,37,71,35,"Date"],[47,41,71,39],[47,42,71,40,"now"],[47,45,71,43],[47,46,71,44],[47,47,71,45],[48,4,72,2],[48,10,72,8,"constraints"],[48,21,72,19],[48,24,72,22,"context"],[48,31,72,29],[48,32,72,30,"businessConstraints"],[48,51,72,49],[48,55,72,53],[48,56,72,54],[48,57,72,55],[49,4,73,2],[49,10,73,8,"totalViews"],[49,20,73,18],[49,23,73,21,"stories"],[49,30,73,28],[49,31,73,29,"reduce"],[49,37,73,35],[49,38,73,36],[49,39,73,37,"sum"],[49,42,73,40],[49,44,73,42,"s"],[49,45,73,43],[49,50,73,48,"sum"],[49,53,73,51],[49,57,73,55,"s"],[49,58,73,56],[49,59,73,57,"engagement"],[49,69,73,67],[49,71,73,69,"views"],[49,76,73,74],[49,80,73,78],[49,81,73,79],[49,82,73,80],[49,84,73,82],[49,85,73,83],[49,86,73,84],[50,4,75,2],[50,11,75,9,"stories"],[50,18,75,16],[50,19,76,5,"map"],[50,22,76,8],[50,23,76,9,"story"],[50,28,76,14],[50,32,76,18],[51,6,77,6],[51,12,77,12,"engagement"],[51,22,77,22],[51,25,77,25,"story"],[51,30,77,30],[51,31,77,31,"engagement"],[51,41,77,41],[51,45,77,45],[52,8,77,47,"impressions"],[52,19,77,58],[52,21,77,60],[52,22,77,61],[53,8,77,63,"ctas"],[53,12,77,67],[53,14,77,69],[53,15,77,70],[54,8,77,72,"purchases"],[54,17,77,81],[54,19,77,83],[54,20,77,84],[55,8,77,86,"views"],[55,13,77,91],[55,15,77,93],[56,6,77,95],[56,7,77,96],[57,6,78,6],[57,12,78,12,"metadata"],[57,20,78,20],[57,23,78,23,"story"],[57,28,78,28],[57,29,78,29,"metadata"],[57,37,78,37],[57,41,78,41],[58,8,78,43,"freshness"],[58,17,78,52],[58,19,78,54,"now"],[58,22,78,57],[59,8,78,59,"commission_rate"],[59,23,78,74],[59,25,78,76],[59,29,78,80],[60,8,78,82,"repetition_penalty"],[60,26,78,100],[60,28,78,102],[60,29,78,103],[61,8,78,105,"creator_tier"],[61,20,78,117],[61,22,78,119],[62,6,78,132],[62,7,78,133],[63,6,79,6],[63,12,79,12,"business"],[63,20,79,20],[63,23,79,23,"story"],[63,28,79,28],[63,29,79,29,"business"],[63,37,79,37],[63,41,79,41],[63,42,79,42],[63,43,79,43],[65,6,81,6],[66,6,82,6],[66,12,82,12,"views"],[66,17,82,17],[66,20,82,20,"Math"],[66,24,82,24],[66,25,82,25,"max"],[66,28,82,28],[66,29,82,29,"engagement"],[66,39,82,39],[66,40,82,40,"views"],[66,45,82,45],[66,49,82,49,"engagement"],[66,59,82,59],[66,60,82,60,"impressions"],[66,71,82,71],[66,73,82,73],[66,74,82,74],[66,75,82,75],[67,6,83,6],[67,12,83,12,"clicks"],[67,18,83,18],[67,21,83,21,"engagement"],[67,31,83,31],[67,32,83,32,"ctas"],[67,36,83,36],[68,6,84,6],[68,12,84,12,"clickRate"],[68,21,84,21],[68,24,84,24,"clicks"],[68,30,84,30],[68,33,84,33,"views"],[68,38,84,38],[69,6,85,6],[69,12,85,12,"exploration"],[69,23,85,23],[69,26,85,26,"Math"],[69,30,85,30],[69,31,85,31,"sqrt"],[69,35,85,35],[69,36,85,36],[69,37,85,37],[69,40,85,40,"Math"],[69,44,85,44],[69,45,85,45,"log"],[69,48,85,48],[69,49,85,49,"Math"],[69,53,85,53],[69,54,85,54,"max"],[69,57,85,57],[69,58,85,58,"totalViews"],[69,68,85,68],[69,70,85,70],[69,71,85,71],[69,72,85,72],[69,73,85,73],[69,76,85,76,"views"],[69,81,85,81],[69,82,85,82],[70,6,86,6],[70,12,86,12,"ucbScore"],[70,20,86,20],[70,23,86,23,"clickRate"],[70,32,86,32],[70,35,86,36],[70,40,86,41],[70,43,86,44,"exploration"],[70,54,86,56],[70,55,86,57],[70,56,86,58],[72,6,88,6],[73,6,89,6],[73,12,89,12,"commissionBoost"],[73,27,89,27],[73,30,89,30,"metadata"],[73,38,89,38],[73,39,89,39,"commission_rate"],[73,54,89,54],[73,58,89,58,"constraints"],[73,69,89,69],[73,70,89,70,"minCommissionRate"],[73,87,89,87],[73,91,89,91],[73,92,89,92],[73,93,89,93],[74,6,90,6],[74,12,90,12,"freshnessBoost"],[74,26,90,26],[74,29,90,29,"Math"],[74,33,90,33],[74,34,90,34,"max"],[74,37,90,37],[74,38,90,38],[74,39,90,39],[74,41,90,41],[74,42,90,42],[74,45,90,45],[74,46,90,46,"now"],[74,49,90,49],[74,52,90,52,"metadata"],[74,60,90,60],[74,61,90,61,"freshness"],[74,70,90,70],[74,75,90,75],[74,77,90,77],[74,80,90,80],[74,82,90,82],[74,85,90,85],[74,87,90,87],[74,90,90,90],[74,94,90,94],[74,95,90,95],[74,96,90,96],[74,100,90,100,"constraints"],[74,111,90,111],[74,112,90,112,"freshnessBoost"],[74,126,90,126],[74,130,90,130],[74,133,90,133],[74,134,90,134],[75,6,91,6],[75,12,91,12,"repetitionPenalty"],[75,29,91,29],[75,32,91,32,"metadata"],[75,40,91,40],[75,41,91,41,"repetition_penalty"],[75,59,91,59],[75,63,91,63,"constraints"],[75,74,91,74],[75,75,91,75,"maxRepetition"],[75,88,91,88],[75,92,91,92],[75,95,91,95],[75,96,91,96],[76,6,92,6],[76,12,92,12,"businessBoost"],[76,25,92,25],[76,28,92,28,"business"],[76,36,92,36],[76,37,92,37,"boost_priority"],[76,51,92,51],[76,55,92,55],[76,56,92,56],[77,6,93,6],[77,12,93,12,"sponsoredBoost"],[77,26,93,26],[77,29,93,29,"business"],[77,37,93,37],[77,38,93,38,"sponsored"],[77,47,93,47],[77,50,93,50],[77,54,93,54],[77,57,93,57],[77,58,93,58],[79,6,95,6],[80,6,96,6],[80,12,96,12,"tierWeights"],[80,23,96,23],[80,26,96,26,"constraints"],[80,37,96,37],[80,38,96,38,"creatorTierWeights"],[80,56,96,56],[80,60,96,60],[81,8,96,62,"gold"],[81,12,96,66],[81,14,96,68],[81,17,96,71],[82,8,96,73,"blue"],[82,12,96,77],[82,14,96,79],[82,18,96,83],[83,8,96,85,"grey"],[83,12,96,89],[83,14,96,91],[83,18,96,95],[84,8,96,97,"unverified"],[84,18,96,107],[84,20,96,109],[85,6,96,111],[85,7,96,112],[86,6,97,6],[86,12,97,12,"tierBoost"],[86,21,97,21],[86,24,97,24,"tierWeights"],[86,35,97,35],[86,36,97,36,"metadata"],[86,44,97,44],[86,45,97,45,"creator_tier"],[86,57,97,57],[86,58,97,58],[86,62,97,62],[86,63,97,63],[88,6,99,6],[89,6,100,6],[89,12,100,12,"finalScore"],[89,22,100,22],[89,25,100,25,"ucbScore"],[89,33,100,33],[89,36,100,36,"commissionBoost"],[89,51,100,51],[89,54,100,54,"freshnessBoost"],[89,68,100,68],[89,71,100,71,"repetitionPenalty"],[89,88,100,88],[89,91,100,91,"businessBoost"],[89,104,100,104],[89,107,100,107,"sponsoredBoost"],[89,121,100,121],[89,124,100,124,"tierBoost"],[89,133,100,133],[90,6,102,6],[90,13,102,13],[91,8,102,15],[91,11,102,18,"story"],[91,16,102,23],[92,8,102,25,"_score"],[92,14,102,31],[92,16,102,33,"finalScore"],[92,26,102,43],[93,8,102,45,"_debug"],[93,14,102,51],[93,16,102,53],[94,10,102,55,"ucbScore"],[94,18,102,63],[95,10,102,65,"commissionBoost"],[95,25,102,80],[96,10,102,82,"freshnessBoost"],[96,24,102,96],[97,10,102,98,"repetitionPenalty"],[98,8,102,116],[99,6,102,118],[99,7,102,119],[100,4,103,4],[100,5,103,5],[100,6,103,6],[100,7,104,5,"sort"],[100,11,104,9],[100,12,104,10],[100,13,104,11,"a"],[100,14,104,12],[100,16,104,14,"b"],[100,17,104,15],[100,22,104,20],[100,23,104,21,"b"],[100,24,104,22],[100,25,104,23,"_score"],[100,31,104,29],[100,35,104,33],[100,36,104,34],[100,41,104,39,"a"],[100,42,104,40],[100,43,104,41,"_score"],[100,49,104,47],[100,53,104,51],[100,54,104,52],[100,55,104,53],[100,56,104,54],[100,57,105,5,"map"],[100,60,105,8],[100,61,105,9],[100,62,105,10],[101,6,105,12,"_score"],[101,12,105,18],[102,6,105,20,"_debug"],[102,12,105,26],[103,6,105,28],[103,9,105,31,"story"],[104,4,105,37],[104,5,105,38],[104,10,105,43,"story"],[104,15,105,48],[104,16,105,49],[105,2,106,0],[105,3,106,1],[107,2,108,0],[108,2,109,7],[108,11,109,16,"applyRanking"],[108,23,109,28,"applyRanking"],[108,24,109,29,"stories"],[108,31,109,45],[108,33,109,47,"context"],[108,40,109,70],[108,42,109,81],[109,4,110,2],[110,4,111,2],[111,4,112,2],[111,11,112,9,"ranker"],[111,17,112,15],[111,18,112,16,"stories"],[111,25,112,23],[111,27,112,25,"context"],[111,34,112,32],[111,35,112,33],[112,2,113,0],[114,2,115,0],[115,2,116,7],[115,11,116,16,"createRankerContext"],[115,30,116,35,"createRankerContext"],[115,31,117,2,"userId"],[115,37,117,16],[115,39,118,2,"sessionId"],[115,48,118,19],[115,50,119,2,"previousStories"],[115,65,119,27],[115,68,119,30],[115,70,119,32],[115,72,120,2,"businessConstraints"],[115,91,120,21],[115,94,120,24],[115,95,120,25],[115,96,120,26],[115,98,121,2,"userPreferences"],[115,113,121,17],[115,116,121,20],[115,117,121,21],[115,118,121,22],[115,120,122,17],[116,4,123,2],[116,11,123,9],[117,6,124,4,"userId"],[117,12,124,10],[118,6,125,4,"sessionId"],[118,15,125,13],[119,6,126,4,"previousStories"],[119,21,126,19],[120,6,127,4,"timestamp"],[120,15,127,13],[120,17,127,15,"Date"],[120,21,127,19],[120,22,127,20,"now"],[120,25,127,23],[120,26,127,24],[120,27,127,25],[121,6,128,4,"businessConstraints"],[121,25,128,23],[122,6,129,4,"userPreferences"],[123,4,130,2],[123,5,130,3],[124,2,131,0],[126,2,133,0],[127,2,134,7],[127,11,134,16,"trackRankerEvent"],[127,27,134,32,"trackRankerEvent"],[127,28,135,2,"storyId"],[127,35,135,17],[127,37,136,2,"eventType"],[127,46,136,56],[127,48,137,2,"context"],[127,55,137,25],[127,57,138,2],[128,4,139,2],[129,4,140,2],[130,4,141,2,"console"],[130,11,141,9],[130,12,141,10,"log"],[130,15,141,13],[130,16,141,14],[130,27,141,25,"eventType"],[130,36,141,34],[130,47,141,45,"storyId"],[130,54,141,52],[130,66,141,64,"context"],[130,73,141,71],[130,75,141,73,"sessionId"],[130,84,141,82],[130,86,141,84],[130,87,141,85],[131,2,142,0],[133,2,144,0],[134,2,145,7],[134,8,145,13,"RANKER_CONFIG"],[134,21,145,26],[134,24,145,29],[135,4,146,2,"enabled"],[135,11,146,9],[135,13,146,11,"process"],[135,20,146,18],[135,21,146,19,"env"],[135,24,146,22],[135,25,146,23,"EXPO_PUBLIC_RANKER_ENABLED"],[135,51,146,49],[135,56,146,54],[135,59,146,57],[136,4,147,2,"algorithm"],[136,13,147,11],[136,15,147,13,"process"],[136,22,147,20],[136,23,147,21,"env"],[136,26,147,24],[136,27,147,25,"EXPO_PUBLIC_RANKER_ALGORITHM"],[136,55,147,53],[136,59,147,57],[136,69,147,67],[137,4,147,69],[138,4,148,2,"lookahead"],[138,13,148,11],[138,15,148,13,"parseInt"],[138,23,148,21],[138,24,148,22,"process"],[138,31,148,29],[138,32,148,30,"env"],[138,35,148,33],[138,36,148,34,"EXPO_PUBLIC_LOOKAHEAD"],[138,57,148,55],[138,61,148,59],[138,64,148,62],[138,65,148,63],[139,4,149,2,"debugMode"],[139,13,149,11],[139,15,149,13,"process"],[139,22,149,20],[139,23,149,21,"env"],[139,26,149,24],[139,27,149,25,"EXPO_PUBLIC_RANKER_DEBUG"],[139,51,149,49],[139,56,149,54],[140,2,150,0],[140,3,150,1],[141,0,150,2],[141,3]],"functionMap":{"names":["<global>","ranker","ucb1Ranker","stories.reduce$argument_0","stories.map$argument_0","stories.map.sort$argument_0","stories.map.sort.map$argument_0","applyRanking","createRankerContext","trackRankerEvent"],"mappings":"AAA;8BC6D;CDG;kCEG;oCCK,4CD;SEG;KF2B;UGC,2CH;SIC,uCJ;CFC;OOG;CPI;OQG;CRe;OSG;CTQ"},"hasCjsExports":false},"type":"js/module"}]}