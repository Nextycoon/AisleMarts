{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/classCallCheck","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"yg7e6laZwmpbIvId5jovq9ugXp8=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/createClass","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"Z6pzkVZ2fvxBLkFTgVVOy4UDj30=","exportNames":["*"],"imports":1}},{"name":"react-native","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":37,"index":37}}],"key":"KyzuX10g6ixS9UfynhmjlvCIG3g=","exportNames":["*"],"imports":1}},{"name":"expo-asset","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":38},"end":{"line":2,"column":35,"index":73}}],"key":"ZXJFWHziJpBZf3W7vl00wXf6fd8=","exportNames":["*"],"imports":1}},{"name":"./LRUMediaCache","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":74},"end":{"line":3,"column":48,"index":122}}],"key":"AKbXoy/C33oPqfy8xlgc1zZu7KU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"PrefetchCoordinator\", {\n    enumerable: true,\n    get: function () {\n      return PrefetchCoordinator;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _babelRuntimeHelpersClassCallCheck = require(_dependencyMap[1], \"@babel/runtime/helpers/classCallCheck\");\n  var _classCallCheck = _interopDefault(_babelRuntimeHelpersClassCallCheck);\n  var _babelRuntimeHelpersCreateClass = require(_dependencyMap[2], \"@babel/runtime/helpers/createClass\");\n  var _createClass = _interopDefault(_babelRuntimeHelpersCreateClass);\n  var _reactNative = require(_dependencyMap[3], \"react-native\");\n  var _expoAsset = require(_dependencyMap[4], \"expo-asset\");\n  var _LRUMediaCache = require(_dependencyMap[5], \"./LRUMediaCache\");\n  var PrefetchCoordinator = /*#__PURE__*/function () {\n    function PrefetchCoordinator(stories) {\n      var lookahead = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 3;\n      var cache = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new _LRUMediaCache.LRUMediaCache();\n      (0, _classCallCheck.default)(this, PrefetchCoordinator);\n      this.stories = stories;\n      this.lookahead = lookahead;\n      this.cache = cache;\n      this.idx = 0;\n    }\n    return (0, _createClass.default)(PrefetchCoordinator, [{\n      key: \"attachGlobal\",\n      value: function attachGlobal() {\n        globalThis.__prefetch = this;\n        this.cache = this.cache;\n      }\n    }, {\n      key: \"updateStories\",\n      value: function updateStories(stories) {\n        this.stories = stories;\n        this.kick();\n      }\n    }, {\n      key: \"focus\",\n      value: function focus(i) {\n        this.idx = i;\n        this.kick();\n      }\n    }, {\n      key: \"prefetch\",\n      value: function () {\n        var _prefetch = (0, _asyncToGenerator.default)(function* (url, type) {\n          if (this.cache.has(url)) return;\n          try {\n            if (type === \"image\") {\n              yield _reactNative.Image.prefetch(url);\n              this.cache.put(url);\n            } else if (type === \"video\") {\n              // Video preloading with expo-asset (file system cache)\n              var asset = _expoAsset.Asset.fromURI(url);\n              yield asset.downloadAsync();\n              this.cache.put(url, asset.downloaded ? asset.filesize ?? 1_500_000 : 1_500_000);\n            }\n          } catch (error) {\n            // Silent fail for prefetch - don't block user experience\n            console.warn(`Prefetch failed for ${type} ${url}:`, error);\n          }\n        });\n        function prefetch(_x, _x2) {\n          return _prefetch.apply(this, arguments);\n        }\n        return prefetch;\n      }()\n    }, {\n      key: \"kick\",\n      value: function () {\n        var _kick = (0, _asyncToGenerator.default)(function* () {\n          for (var d = 1; d <= this.lookahead; d++) {\n            var s = this.stories[this.idx + d];\n            if (!s) continue;\n            yield this.prefetch(s.mediaUrl, s.type);\n          }\n        });\n        function kick() {\n          return _kick.apply(this, arguments);\n        }\n        return kick;\n      }() // P1b: Get prefetch statistics for performance monitoring\n    }, {\n      key: \"getStats\",\n      value: function getStats() {\n        var usage = this.cache.usageMB();\n        return {\n          cacheUsageMB: usage,\n          lookahead: this.lookahead,\n          currentIndex: this.idx,\n          totalStories: this.stories.length\n        };\n      }\n\n      // P1b: Dynamic lookahead adjustment based on performance\n    }, {\n      key: \"adjustLookahead\",\n      value: function adjustLookahead(newLookahead) {\n        this.lookahead = Math.max(1, Math.min(5, newLookahead));\n      }\n    }]);\n  }();\n});","lineCount":115,"map":[[12,2,7,0,"Object"],[12,8,7,0],[12,9,7,0,"defineProperty"],[12,23,7,0],[12,24,7,0,"exports"],[12,31,7,0],[13,4,7,0,"enumerable"],[13,14,7,0],[14,4,7,0,"get"],[14,7,7,0],[14,18,7,0,"get"],[14,19,7,0],[15,6,7,0],[15,13,7,0,"PrefetchCoordinator"],[15,32,7,0],[16,4,7,0],[17,2,7,0],[18,2,55,1],[18,6,55,1,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,55,1],[18,45,55,1,"require"],[18,52,55,1],[18,53,55,1,"_dependencyMap"],[18,67,55,1],[19,2,55,1],[19,6,55,1,"_asyncToGenerator"],[19,23,55,1],[19,26,55,1,"_interopDefault"],[19,41,55,1],[19,42,55,1,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,55,1],[20,2,55,1],[20,6,55,1,"_babelRuntimeHelpersClassCallCheck"],[20,40,55,1],[20,43,55,1,"require"],[20,50,55,1],[20,51,55,1,"_dependencyMap"],[20,65,55,1],[21,2,55,1],[21,6,55,1,"_classCallCheck"],[21,21,55,1],[21,24,55,1,"_interopDefault"],[21,39,55,1],[21,40,55,1,"_babelRuntimeHelpersClassCallCheck"],[21,74,55,1],[22,2,55,1],[22,6,55,1,"_babelRuntimeHelpersCreateClass"],[22,37,55,1],[22,40,55,1,"require"],[22,47,55,1],[22,48,55,1,"_dependencyMap"],[22,62,55,1],[23,2,55,1],[23,6,55,1,"_createClass"],[23,18,55,1],[23,21,55,1,"_interopDefault"],[23,36,55,1],[23,37,55,1,"_babelRuntimeHelpersCreateClass"],[23,68,55,1],[24,2,1,0],[24,6,1,0,"_reactNative"],[24,18,1,0],[24,21,1,0,"require"],[24,28,1,0],[24,29,1,0,"_dependencyMap"],[24,43,1,0],[25,2,2,0],[25,6,2,0,"_expoAsset"],[25,16,2,0],[25,19,2,0,"require"],[25,26,2,0],[25,27,2,0,"_dependencyMap"],[25,41,2,0],[26,2,3,0],[26,6,3,0,"_LRUMediaCache"],[26,20,3,0],[26,23,3,0,"require"],[26,30,3,0],[26,31,3,0,"_dependencyMap"],[26,45,3,0],[27,2,3,48],[27,6,7,13,"PrefetchCoordinator"],[27,25,7,32],[28,4,9,2],[28,13,9,2,"PrefetchCoordinator"],[28,33,9,22,"stories"],[28,40,9,38],[28,42,9,100],[29,6,9,100],[29,10,9,48,"lookahead"],[29,19,9,57],[29,22,9,57,"arguments"],[29,31,9,57],[29,32,9,57,"length"],[29,38,9,57],[29,46,9,57,"arguments"],[29,55,9,57],[29,63,9,57,"undefined"],[29,72,9,57],[29,75,9,57,"arguments"],[29,84,9,57],[29,90,9,60],[29,91,9,61],[30,6,9,61],[30,10,9,71,"cache"],[30,15,9,76],[30,18,9,76,"arguments"],[30,27,9,76],[30,28,9,76,"length"],[30,34,9,76],[30,42,9,76,"arguments"],[30,51,9,76],[30,59,9,76,"undefined"],[30,68,9,76],[30,71,9,76,"arguments"],[30,80,9,76],[30,86,9,79],[30,90,9,83,"LRUMediaCache"],[30,104,9,96],[30,105,9,96,"LRUMediaCache"],[30,118,9,96],[30,119,9,97],[30,120,9,98],[31,6,9,98],[31,10,9,98,"_classCallCheck"],[31,25,9,98],[31,26,9,98,"default"],[31,33,9,98],[31,41,9,98,"PrefetchCoordinator"],[31,60,9,98],[32,6,9,98],[32,11,9,22,"stories"],[32,18,9,38],[32,21,9,22,"stories"],[32,28,9,38],[33,6,9,38],[33,11,9,48,"lookahead"],[33,20,9,57],[33,23,9,48,"lookahead"],[33,32,9,57],[34,6,9,57],[34,11,9,71,"cache"],[34,16,9,76],[34,19,9,71,"cache"],[34,24,9,76],[35,6,9,76],[35,11,8,10,"idx"],[35,14,8,13],[35,17,8,16],[35,18,8,17],[36,4,9,101],[37,4,9,102],[37,15,9,102,"_createClass"],[37,27,9,102],[37,28,9,102,"default"],[37,35,9,102],[37,37,9,102,"PrefetchCoordinator"],[37,56,9,102],[38,6,9,102,"key"],[38,9,9,102],[39,6,9,102,"value"],[39,11,9,102],[39,13,10,2],[39,22,10,2,"attachGlobal"],[39,34,10,14,"attachGlobal"],[39,35,10,14],[39,37,10,17],[40,8,10,20,"globalThis"],[40,18,10,30],[40,19,10,39,"__prefetch"],[40,29,10,49],[40,32,10,52],[40,36,10,56],[41,8,10,59],[41,12,10,63],[41,13,10,72,"cache"],[41,18,10,77],[41,21,10,80],[41,25,10,84],[41,26,10,85,"cache"],[41,31,10,90],[42,6,10,92],[43,4,10,93],[44,6,10,93,"key"],[44,9,10,93],[45,6,10,93,"value"],[45,11,10,93],[45,13,11,2],[45,22,11,2,"updateStories"],[45,35,11,15,"updateStories"],[45,36,11,16,"stories"],[45,43,11,32],[45,45,11,34],[46,8,11,36],[46,12,11,40],[46,13,11,41,"stories"],[46,20,11,48],[46,23,11,51,"stories"],[46,30,11,58],[47,8,11,60],[47,12,11,64],[47,13,11,65,"kick"],[47,17,11,69],[47,18,11,70],[47,19,11,71],[48,6,11,73],[49,4,11,74],[50,6,11,74,"key"],[50,9,11,74],[51,6,11,74,"value"],[51,11,11,74],[51,13,12,2],[51,22,12,2,"focus"],[51,27,12,7,"focus"],[51,28,12,8,"i"],[51,29,12,17],[51,31,12,19],[52,8,12,21],[52,12,12,25],[52,13,12,26,"idx"],[52,16,12,29],[52,19,12,32,"i"],[52,20,12,33],[53,8,12,35],[53,12,12,39],[53,13,12,40,"kick"],[53,17,12,44],[53,18,12,45],[53,19,12,46],[54,6,12,48],[55,4,12,49],[56,6,12,49,"key"],[56,9,12,49],[57,6,12,49,"value"],[57,11,12,49],[58,8,12,49],[58,12,12,49,"_prefetch"],[58,21,12,49],[58,28,12,49,"_asyncToGenerator"],[58,45,12,49],[58,46,12,49,"default"],[58,53,12,49],[58,55,14,2],[58,66,14,25,"url"],[58,69,14,36],[58,71,14,38,"type"],[58,75,14,57],[58,77,14,59],[59,10,15,4],[59,14,15,8],[59,18,15,12],[59,19,15,13,"cache"],[59,24,15,18],[59,25,15,19,"has"],[59,28,15,22],[59,29,15,23,"url"],[59,32,15,26],[59,33,15,27],[59,35,15,29],[60,10,16,4],[60,14,16,8],[61,12,17,6],[61,16,17,10,"type"],[61,20,17,14],[61,25,17,19],[61,32,17,26],[61,34,17,28],[62,14,18,8],[62,20,18,14,"Image"],[62,32,18,19],[62,33,18,19,"Image"],[62,38,18,19],[62,39,18,20,"prefetch"],[62,47,18,28],[62,48,18,29,"url"],[62,51,18,32],[62,52,18,33],[63,14,19,8],[63,18,19,12],[63,19,19,13,"cache"],[63,24,19,18],[63,25,19,19,"put"],[63,28,19,22],[63,29,19,23,"url"],[63,32,19,26],[63,33,19,27],[64,12,20,6],[64,13,20,7],[64,19,20,13],[64,23,20,17,"type"],[64,27,20,21],[64,32,20,26],[64,39,20,33],[64,41,20,35],[65,14,21,8],[66,14,22,8],[66,18,22,14,"asset"],[66,23,22,19],[66,26,22,22,"Asset"],[66,36,22,27],[66,37,22,27,"Asset"],[66,42,22,27],[66,43,22,28,"fromURI"],[66,50,22,35],[66,51,22,36,"url"],[66,54,22,39],[66,55,22,40],[67,14,23,8],[67,20,23,14,"asset"],[67,25,23,19],[67,26,23,20,"downloadAsync"],[67,39,23,33],[67,40,23,34],[67,41,23,35],[68,14,24,8],[68,18,24,12],[68,19,24,13,"cache"],[68,24,24,18],[68,25,24,19,"put"],[68,28,24,22],[68,29,24,23,"url"],[68,32,24,26],[68,34,24,28,"asset"],[68,39,24,33],[68,40,24,34,"downloaded"],[68,50,24,44],[68,53,24,47,"asset"],[68,58,24,52],[68,59,24,53,"filesize"],[68,67,24,61],[68,71,24,65],[68,80,24,74],[68,83,24,77],[68,92,24,86],[68,93,24,87],[69,12,25,6],[70,10,26,4],[70,11,26,5],[70,12,26,6],[70,19,26,13,"error"],[70,24,26,18],[70,26,26,20],[71,12,27,6],[72,12,28,6,"console"],[72,19,28,13],[72,20,28,14,"warn"],[72,24,28,18],[72,25,28,19],[72,48,28,42,"type"],[72,52,28,46],[72,56,28,50,"url"],[72,59,28,53],[72,62,28,56],[72,64,28,58,"error"],[72,69,28,63],[72,70,28,64],[73,10,29,4],[74,8,30,2],[74,9,30,3],[75,8,30,3],[75,17,14,16,"prefetch"],[75,25,14,24,"prefetch"],[75,26,14,24,"_x"],[75,28,14,24],[75,30,14,24,"_x2"],[75,33,14,24],[76,10,14,24],[76,17,14,24,"_prefetch"],[76,26,14,24],[76,27,14,24,"apply"],[76,32,14,24],[76,39,14,24,"arguments"],[76,48,14,24],[77,8,14,24],[78,8,14,24],[78,15,14,16,"prefetch"],[78,23,14,24],[79,6,14,24],[80,4,14,24],[81,6,14,24,"key"],[81,9,14,24],[82,6,14,24,"value"],[82,11,14,24],[83,8,14,24],[83,12,14,24,"_kick"],[83,17,14,24],[83,24,14,24,"_asyncToGenerator"],[83,41,14,24],[83,42,14,24,"default"],[83,49,14,24],[83,51,32,2],[83,64,32,23],[84,10,33,4],[84,15,33,9],[84,19,33,13,"d"],[84,20,33,14],[84,23,33,17],[84,24,33,18],[84,26,33,20,"d"],[84,27,33,21],[84,31,33,25],[84,35,33,29],[84,36,33,30,"lookahead"],[84,45,33,39],[84,47,33,41,"d"],[84,48,33,42],[84,50,33,44],[84,52,33,46],[85,12,34,6],[85,16,34,12,"s"],[85,17,34,13],[85,20,34,16],[85,24,34,20],[85,25,34,21,"stories"],[85,32,34,28],[85,33,34,29],[85,37,34,33],[85,38,34,34,"idx"],[85,41,34,37],[85,44,34,40,"d"],[85,45,34,41],[85,46,34,42],[86,12,35,6],[86,16,35,10],[86,17,35,11,"s"],[86,18,35,12],[86,20,35,14],[87,12,36,6],[87,18,36,12],[87,22,36,16],[87,23,36,17,"prefetch"],[87,31,36,25],[87,32,36,26,"s"],[87,33,36,27],[87,34,36,28,"mediaUrl"],[87,42,36,36],[87,44,36,38,"s"],[87,45,36,39],[87,46,36,40,"type"],[87,50,36,44],[87,51,36,45],[88,10,37,4],[89,8,38,2],[89,9,38,3],[90,8,38,3],[90,17,32,16,"kick"],[90,21,32,20,"kick"],[90,22,32,20],[91,10,32,20],[91,17,32,20,"_kick"],[91,22,32,20],[91,23,32,20,"apply"],[91,28,32,20],[91,35,32,20,"arguments"],[91,44,32,20],[92,8,32,20],[93,8,32,20],[93,15,32,16,"kick"],[93,19,32,20],[94,6,32,20],[94,10,40,2],[95,4,40,2],[96,6,40,2,"key"],[96,9,40,2],[97,6,40,2,"value"],[97,11,40,2],[97,13,41,2],[97,22,41,2,"getStats"],[97,30,41,10,"getStats"],[97,31,41,10],[97,33,41,13],[98,8,42,4],[98,12,42,10,"usage"],[98,17,42,15],[98,20,42,18],[98,24,42,22],[98,25,42,23,"cache"],[98,30,42,28],[98,31,42,29,"usageMB"],[98,38,42,36],[98,39,42,37],[98,40,42,38],[99,8,43,4],[99,15,43,11],[100,10,44,6,"cacheUsageMB"],[100,22,44,18],[100,24,44,20,"usage"],[100,29,44,25],[101,10,45,6,"lookahead"],[101,19,45,15],[101,21,45,17],[101,25,45,21],[101,26,45,22,"lookahead"],[101,35,45,31],[102,10,46,6,"currentIndex"],[102,22,46,18],[102,24,46,20],[102,28,46,24],[102,29,46,25,"idx"],[102,32,46,28],[103,10,47,6,"totalStories"],[103,22,47,18],[103,24,47,20],[103,28,47,24],[103,29,47,25,"stories"],[103,36,47,32],[103,37,47,33,"length"],[104,8,48,4],[104,9,48,5],[105,6,49,2],[107,6,51,2],[108,4,51,2],[109,6,51,2,"key"],[109,9,51,2],[110,6,51,2,"value"],[110,11,51,2],[110,13,52,2],[110,22,52,2,"adjustLookahead"],[110,37,52,17,"adjustLookahead"],[110,38,52,18,"newLookahead"],[110,50,52,38],[110,52,52,40],[111,8,53,4],[111,12,53,8],[111,13,53,9,"lookahead"],[111,22,53,18],[111,25,53,21,"Math"],[111,29,53,25],[111,30,53,26,"max"],[111,33,53,29],[111,34,53,30],[111,35,53,31],[111,37,53,33,"Math"],[111,41,53,37],[111,42,53,38,"min"],[111,45,53,41],[111,46,53,42],[111,47,53,43],[111,49,53,45,"newLookahead"],[111,61,53,57],[111,62,53,58],[111,63,53,59],[112,6,54,2],[113,4,54,3],[114,2,54,3],[115,0,54,3],[115,3]],"functionMap":{"names":["<global>","PrefetchCoordinator","constructor","attachGlobal","updateStories","focus","prefetch","kick","getStats","adjustLookahead"],"mappings":"AAA;OCM;ECE,oGD;EEC,2FF;EGC,wEH;EIC,+CJ;EKE;GLgB;EME;GNM;EOG;GPQ;EQG;GRE"},"hasCjsExports":false},"type":"js/module"}]}