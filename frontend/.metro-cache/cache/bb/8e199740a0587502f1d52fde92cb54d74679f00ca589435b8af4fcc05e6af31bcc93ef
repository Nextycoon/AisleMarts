{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}},{"name":"../lib/httpQueue","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":43,"index":43}}],"key":"UNbPMuWtLYecEbQDRIZNKaHFi18=","exportNames":["*"],"imports":1}},{"name":"crypto-js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":44},"end":{"line":2,"column":31,"index":75}}],"key":"TLjsXnAWOlf/gpObabse3HZX8VY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.trackPurchase = trackPurchase;\n  exports.trackCTA = trackCTA;\n  exports.trackImpression = trackImpression;\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _libHttpQueue = require(_dependencyMap[1], \"../lib/httpQueue\");\n  var _cryptoJs = require(_dependencyMap[2], \"crypto-js\");\n  var crypto = _interopDefault(_cryptoJs);\n  // Helper to generate HMAC signature\n  function generateHMAC(timestamp, body) {\n    const secret = _expoVirtualEnv.env.EXPO_PUBLIC_HMAC_SECRET || 'dev-secret-key-change-in-production';\n    const payload = `${timestamp}.${JSON.stringify(body)}`;\n    return crypto.default.HmacSHA256(payload, secret).toString();\n  }\n\n  // Helper to generate idempotency key\n  function generateIdempotencyKey(type, data) {\n    const unique = `${type}-${Date.now()}-${JSON.stringify(data)}`;\n    return crypto.default.SHA256(unique).toString().substr(0, 16);\n  }\n  async function trackPurchase(url, body) {\n    const timestamp = Date.now();\n    const signature = generateHMAC(timestamp, body);\n    const idempotencyKey = generateIdempotencyKey('purchase', body);\n    const headers = {\n      'Content-Type': 'application/json',\n      'X-Timestamp': timestamp.toString(),\n      'X-Signature': signature,\n      'Idempotency-Key': idempotencyKey\n    };\n    try {\n      const response = await fetch(url, {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(body)\n      });\n      if (!response.ok && response.status !== 409) {\n        // If request fails (but not due to idempotency), queue it\n        await (0, _libHttpQueue.enqueue)(url, body, headers);\n        return {\n          queued: true,\n          status: response.status\n        };\n      }\n      return {\n        success: true,\n        status: response.status\n      };\n    } catch (error) {\n      // Network error - queue the request\n      await (0, _libHttpQueue.enqueue)(url, body, headers);\n      return {\n        queued: true,\n        error: error.message\n      };\n    }\n  }\n  async function trackCTA(url, body) {\n    const timestamp = Date.now();\n    const idempotencyKey = generateIdempotencyKey('cta', body);\n    const headers = {\n      'Content-Type': 'application/json',\n      'Idempotency-Key': idempotencyKey\n    };\n    try {\n      const response = await fetch(url, {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(body)\n      });\n      if (!response.ok && response.status !== 409) {\n        await (0, _libHttpQueue.enqueue)(url, body, headers);\n        return {\n          queued: true,\n          status: response.status\n        };\n      }\n      return {\n        success: true,\n        status: response.status\n      };\n    } catch (error) {\n      await (0, _libHttpQueue.enqueue)(url, body, headers);\n      return {\n        queued: true,\n        error: error.message\n      };\n    }\n  }\n  async function trackImpression(url, body) {\n    const timestamp = Date.now();\n    const idempotencyKey = generateIdempotencyKey('impression', body);\n    const headers = {\n      'Content-Type': 'application/json',\n      'Idempotency-Key': idempotencyKey\n    };\n    try {\n      const response = await fetch(url, {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(body)\n      });\n      if (!response.ok && response.status !== 409) {\n        await (0, _libHttpQueue.enqueue)(url, body, headers);\n        return {\n          queued: true,\n          status: response.status\n        };\n      }\n      return {\n        success: true,\n        status: response.status\n      };\n    } catch (error) {\n      await (0, _libHttpQueue.enqueue)(url, body, headers);\n      return {\n        queued: true,\n        error: error.message\n      };\n    }\n  }\n});","lineCount":132,"map":[[12,2,17,0,"exports"],[12,9,17,0],[12,10,17,0,"trackPurchase"],[12,23,17,0],[12,26,17,0,"trackPurchase"],[12,39,17,0],[13,2,50,0,"exports"],[13,9,50,0],[13,10,50,0,"trackCTA"],[13,18,50,0],[13,21,50,0,"trackCTA"],[13,29,50,0],[14,2,78,0,"exports"],[14,9,78,0],[14,10,78,0,"trackImpression"],[14,25,78,0],[14,28,78,0,"trackImpression"],[14,43,78,0],[15,2,104,1],[15,6,104,1,"_expoVirtualEnv"],[15,21,104,1],[15,24,104,1,"require"],[15,31,104,1],[15,32,104,1,"_dependencyMap"],[15,46,104,1],[16,2,1,0],[16,6,1,0,"_libHttpQueue"],[16,19,1,0],[16,22,1,0,"require"],[16,29,1,0],[16,30,1,0,"_dependencyMap"],[16,44,1,0],[17,2,2,0],[17,6,2,0,"_cryptoJs"],[17,15,2,0],[17,18,2,0,"require"],[17,25,2,0],[17,26,2,0,"_dependencyMap"],[17,40,2,0],[18,2,2,0],[18,6,2,0,"crypto"],[18,12,2,0],[18,15,2,0,"_interopDefault"],[18,30,2,0],[18,31,2,0,"_cryptoJs"],[18,40,2,0],[19,2,4,0],[20,2,5,0],[20,11,5,9,"generateHMAC"],[20,23,5,21,"generateHMAC"],[20,24,5,22,"timestamp"],[20,33,5,39],[20,35,5,41,"body"],[20,39,5,50],[20,41,5,60],[21,4,6,2],[21,10,6,8,"secret"],[21,16,6,14],[21,19,6,17,"_expoVirtualEnv"],[21,34,6,17],[21,35,6,17,"env"],[21,38,6,17],[21,39,6,17,"EXPO_PUBLIC_HMAC_SECRET"],[21,62,6,17],[21,66,6,56],[21,103,6,93],[22,4,7,2],[22,10,7,8,"payload"],[22,17,7,15],[22,20,7,18],[22,23,7,21,"timestamp"],[22,32,7,30],[22,36,7,34,"JSON"],[22,40,7,38],[22,41,7,39,"stringify"],[22,50,7,48],[22,51,7,49,"body"],[22,55,7,53],[22,56,7,54],[22,58,7,56],[23,4,8,2],[23,11,8,9,"crypto"],[23,17,8,15],[23,18,8,15,"default"],[23,25,8,15],[23,26,8,16,"HmacSHA256"],[23,36,8,26],[23,37,8,27,"payload"],[23,44,8,34],[23,46,8,36,"secret"],[23,52,8,42],[23,53,8,43],[23,54,8,44,"toString"],[23,62,8,52],[23,63,8,53],[23,64,8,54],[24,2,9,0],[26,2,11,0],[27,2,12,0],[27,11,12,9,"generateIdempotencyKey"],[27,33,12,31,"generateIdempotencyKey"],[27,34,12,32,"type"],[27,38,12,44],[27,40,12,46,"data"],[27,44,12,55],[27,46,12,65],[28,4,13,2],[28,10,13,8,"unique"],[28,16,13,14],[28,19,13,17],[28,22,13,20,"type"],[28,26,13,24],[28,30,13,28,"Date"],[28,34,13,32],[28,35,13,33,"now"],[28,38,13,36],[28,39,13,37],[28,40,13,38],[28,44,13,42,"JSON"],[28,48,13,46],[28,49,13,47,"stringify"],[28,58,13,56],[28,59,13,57,"data"],[28,63,13,61],[28,64,13,62],[28,66,13,64],[29,4,14,2],[29,11,14,9,"crypto"],[29,17,14,15],[29,18,14,15,"default"],[29,25,14,15],[29,26,14,16,"SHA256"],[29,32,14,22],[29,33,14,23,"unique"],[29,39,14,29],[29,40,14,30],[29,41,14,31,"toString"],[29,49,14,39],[29,50,14,40],[29,51,14,41],[29,52,14,42,"substr"],[29,58,14,48],[29,59,14,49],[29,60,14,50],[29,62,14,52],[29,64,14,54],[29,65,14,55],[30,2,15,0],[31,2,17,7],[31,17,17,22,"trackPurchase"],[31,30,17,35,"trackPurchase"],[31,31,17,36,"url"],[31,34,17,47],[31,36,17,49,"body"],[31,40,17,58],[31,42,17,60],[32,4,18,2],[32,10,18,8,"timestamp"],[32,19,18,17],[32,22,18,20,"Date"],[32,26,18,24],[32,27,18,25,"now"],[32,30,18,28],[32,31,18,29],[32,32,18,30],[33,4,19,2],[33,10,19,8,"signature"],[33,19,19,17],[33,22,19,20,"generateHMAC"],[33,34,19,32],[33,35,19,33,"timestamp"],[33,44,19,42],[33,46,19,44,"body"],[33,50,19,48],[33,51,19,49],[34,4,20,2],[34,10,20,8,"idempotencyKey"],[34,24,20,22],[34,27,20,25,"generateIdempotencyKey"],[34,49,20,47],[34,50,20,48],[34,60,20,58],[34,62,20,60,"body"],[34,66,20,64],[34,67,20,65],[35,4,22,2],[35,10,22,8,"headers"],[35,17,22,15],[35,20,22,18],[36,6,23,4],[36,20,23,18],[36,22,23,20],[36,40,23,38],[37,6,24,4],[37,19,24,17],[37,21,24,19,"timestamp"],[37,30,24,28],[37,31,24,29,"toString"],[37,39,24,37],[37,40,24,38],[37,41,24,39],[38,6,25,4],[38,19,25,17],[38,21,25,19,"signature"],[38,30,25,28],[39,6,26,4],[39,23,26,21],[39,25,26,23,"idempotencyKey"],[40,4,27,2],[40,5,27,3],[41,4,29,2],[41,8,29,6],[42,6,30,4],[42,12,30,10,"response"],[42,20,30,18],[42,23,30,21],[42,29,30,27,"fetch"],[42,34,30,32],[42,35,30,33,"url"],[42,38,30,36],[42,40,30,38],[43,8,31,6,"method"],[43,14,31,12],[43,16,31,14],[43,22,31,20],[44,8,32,6,"headers"],[44,15,32,13],[45,8,33,6,"body"],[45,12,33,10],[45,14,33,12,"JSON"],[45,18,33,16],[45,19,33,17,"stringify"],[45,28,33,26],[45,29,33,27,"body"],[45,33,33,31],[46,6,34,4],[46,7,34,5],[46,8,34,6],[47,6,36,4],[47,10,36,8],[47,11,36,9,"response"],[47,19,36,17],[47,20,36,18,"ok"],[47,22,36,20],[47,26,36,24,"response"],[47,34,36,32],[47,35,36,33,"status"],[47,41,36,39],[47,46,36,44],[47,49,36,47],[47,51,36,49],[48,8,37,6],[49,8,38,6],[49,14,38,12],[49,18,38,12,"enqueue"],[49,31,38,19],[49,32,38,19,"enqueue"],[49,39,38,19],[49,41,38,20,"url"],[49,44,38,23],[49,46,38,25,"body"],[49,50,38,29],[49,52,38,31,"headers"],[49,59,38,38],[49,60,38,39],[50,8,39,6],[50,15,39,13],[51,10,39,15,"queued"],[51,16,39,21],[51,18,39,23],[51,22,39,27],[52,10,39,29,"status"],[52,16,39,35],[52,18,39,37,"response"],[52,26,39,45],[52,27,39,46,"status"],[53,8,39,53],[53,9,39,54],[54,6,40,4],[55,6,42,4],[55,13,42,11],[56,8,42,13,"success"],[56,15,42,20],[56,17,42,22],[56,21,42,26],[57,8,42,28,"status"],[57,14,42,34],[57,16,42,36,"response"],[57,24,42,44],[57,25,42,45,"status"],[58,6,42,52],[58,7,42,53],[59,4,43,2],[59,5,43,3],[59,6,43,4],[59,13,43,11,"error"],[59,18,43,16],[59,20,43,18],[60,6,44,4],[61,6,45,4],[61,12,45,10],[61,16,45,10,"enqueue"],[61,29,45,17],[61,30,45,17,"enqueue"],[61,37,45,17],[61,39,45,18,"url"],[61,42,45,21],[61,44,45,23,"body"],[61,48,45,27],[61,50,45,29,"headers"],[61,57,45,36],[61,58,45,37],[62,6,46,4],[62,13,46,11],[63,8,46,13,"queued"],[63,14,46,19],[63,16,46,21],[63,20,46,25],[64,8,46,27,"error"],[64,13,46,32],[64,15,46,34,"error"],[64,20,46,39],[64,21,46,40,"message"],[65,6,46,48],[65,7,46,49],[66,4,47,2],[67,2,48,0],[68,2,50,7],[68,17,50,22,"trackCTA"],[68,25,50,30,"trackCTA"],[68,26,50,31,"url"],[68,29,50,42],[68,31,50,44,"body"],[68,35,50,53],[68,37,50,55],[69,4,51,2],[69,10,51,8,"timestamp"],[69,19,51,17],[69,22,51,20,"Date"],[69,26,51,24],[69,27,51,25,"now"],[69,30,51,28],[69,31,51,29],[69,32,51,30],[70,4,52,2],[70,10,52,8,"idempotencyKey"],[70,24,52,22],[70,27,52,25,"generateIdempotencyKey"],[70,49,52,47],[70,50,52,48],[70,55,52,53],[70,57,52,55,"body"],[70,61,52,59],[70,62,52,60],[71,4,54,2],[71,10,54,8,"headers"],[71,17,54,15],[71,20,54,18],[72,6,55,4],[72,20,55,18],[72,22,55,20],[72,40,55,38],[73,6,56,4],[73,23,56,21],[73,25,56,23,"idempotencyKey"],[74,4,57,2],[74,5,57,3],[75,4,59,2],[75,8,59,6],[76,6,60,4],[76,12,60,10,"response"],[76,20,60,18],[76,23,60,21],[76,29,60,27,"fetch"],[76,34,60,32],[76,35,60,33,"url"],[76,38,60,36],[76,40,60,38],[77,8,61,6,"method"],[77,14,61,12],[77,16,61,14],[77,22,61,20],[78,8,62,6,"headers"],[78,15,62,13],[79,8,63,6,"body"],[79,12,63,10],[79,14,63,12,"JSON"],[79,18,63,16],[79,19,63,17,"stringify"],[79,28,63,26],[79,29,63,27,"body"],[79,33,63,31],[80,6,64,4],[80,7,64,5],[80,8,64,6],[81,6,66,4],[81,10,66,8],[81,11,66,9,"response"],[81,19,66,17],[81,20,66,18,"ok"],[81,22,66,20],[81,26,66,24,"response"],[81,34,66,32],[81,35,66,33,"status"],[81,41,66,39],[81,46,66,44],[81,49,66,47],[81,51,66,49],[82,8,67,6],[82,14,67,12],[82,18,67,12,"enqueue"],[82,31,67,19],[82,32,67,19,"enqueue"],[82,39,67,19],[82,41,67,20,"url"],[82,44,67,23],[82,46,67,25,"body"],[82,50,67,29],[82,52,67,31,"headers"],[82,59,67,38],[82,60,67,39],[83,8,68,6],[83,15,68,13],[84,10,68,15,"queued"],[84,16,68,21],[84,18,68,23],[84,22,68,27],[85,10,68,29,"status"],[85,16,68,35],[85,18,68,37,"response"],[85,26,68,45],[85,27,68,46,"status"],[86,8,68,53],[86,9,68,54],[87,6,69,4],[88,6,71,4],[88,13,71,11],[89,8,71,13,"success"],[89,15,71,20],[89,17,71,22],[89,21,71,26],[90,8,71,28,"status"],[90,14,71,34],[90,16,71,36,"response"],[90,24,71,44],[90,25,71,45,"status"],[91,6,71,52],[91,7,71,53],[92,4,72,2],[92,5,72,3],[92,6,72,4],[92,13,72,11,"error"],[92,18,72,16],[92,20,72,18],[93,6,73,4],[93,12,73,10],[93,16,73,10,"enqueue"],[93,29,73,17],[93,30,73,17,"enqueue"],[93,37,73,17],[93,39,73,18,"url"],[93,42,73,21],[93,44,73,23,"body"],[93,48,73,27],[93,50,73,29,"headers"],[93,57,73,36],[93,58,73,37],[94,6,74,4],[94,13,74,11],[95,8,74,13,"queued"],[95,14,74,19],[95,16,74,21],[95,20,74,25],[96,8,74,27,"error"],[96,13,74,32],[96,15,74,34,"error"],[96,20,74,39],[96,21,74,40,"message"],[97,6,74,48],[97,7,74,49],[98,4,75,2],[99,2,76,0],[100,2,78,7],[100,17,78,22,"trackImpression"],[100,32,78,37,"trackImpression"],[100,33,78,38,"url"],[100,36,78,49],[100,38,78,51,"body"],[100,42,78,60],[100,44,78,62],[101,4,79,2],[101,10,79,8,"timestamp"],[101,19,79,17],[101,22,79,20,"Date"],[101,26,79,24],[101,27,79,25,"now"],[101,30,79,28],[101,31,79,29],[101,32,79,30],[102,4,80,2],[102,10,80,8,"idempotencyKey"],[102,24,80,22],[102,27,80,25,"generateIdempotencyKey"],[102,49,80,47],[102,50,80,48],[102,62,80,60],[102,64,80,62,"body"],[102,68,80,66],[102,69,80,67],[103,4,82,2],[103,10,82,8,"headers"],[103,17,82,15],[103,20,82,18],[104,6,83,4],[104,20,83,18],[104,22,83,20],[104,40,83,38],[105,6,84,4],[105,23,84,21],[105,25,84,23,"idempotencyKey"],[106,4,85,2],[106,5,85,3],[107,4,87,2],[107,8,87,6],[108,6,88,4],[108,12,88,10,"response"],[108,20,88,18],[108,23,88,21],[108,29,88,27,"fetch"],[108,34,88,32],[108,35,88,33,"url"],[108,38,88,36],[108,40,88,38],[109,8,89,6,"method"],[109,14,89,12],[109,16,89,14],[109,22,89,20],[110,8,90,6,"headers"],[110,15,90,13],[111,8,91,6,"body"],[111,12,91,10],[111,14,91,12,"JSON"],[111,18,91,16],[111,19,91,17,"stringify"],[111,28,91,26],[111,29,91,27,"body"],[111,33,91,31],[112,6,92,4],[112,7,92,5],[112,8,92,6],[113,6,94,4],[113,10,94,8],[113,11,94,9,"response"],[113,19,94,17],[113,20,94,18,"ok"],[113,22,94,20],[113,26,94,24,"response"],[113,34,94,32],[113,35,94,33,"status"],[113,41,94,39],[113,46,94,44],[113,49,94,47],[113,51,94,49],[114,8,95,6],[114,14,95,12],[114,18,95,12,"enqueue"],[114,31,95,19],[114,32,95,19,"enqueue"],[114,39,95,19],[114,41,95,20,"url"],[114,44,95,23],[114,46,95,25,"body"],[114,50,95,29],[114,52,95,31,"headers"],[114,59,95,38],[114,60,95,39],[115,8,96,6],[115,15,96,13],[116,10,96,15,"queued"],[116,16,96,21],[116,18,96,23],[116,22,96,27],[117,10,96,29,"status"],[117,16,96,35],[117,18,96,37,"response"],[117,26,96,45],[117,27,96,46,"status"],[118,8,96,53],[118,9,96,54],[119,6,97,4],[120,6,99,4],[120,13,99,11],[121,8,99,13,"success"],[121,15,99,20],[121,17,99,22],[121,21,99,26],[122,8,99,28,"status"],[122,14,99,34],[122,16,99,36,"response"],[122,24,99,44],[122,25,99,45,"status"],[123,6,99,52],[123,7,99,53],[124,4,100,2],[124,5,100,3],[124,6,100,4],[124,13,100,11,"error"],[124,18,100,16],[124,20,100,18],[125,6,101,4],[125,12,101,10],[125,16,101,10,"enqueue"],[125,29,101,17],[125,30,101,17,"enqueue"],[125,37,101,17],[125,39,101,18,"url"],[125,42,101,21],[125,44,101,23,"body"],[125,48,101,27],[125,50,101,29,"headers"],[125,57,101,36],[125,58,101,37],[126,6,102,4],[126,13,102,11],[127,8,102,13,"queued"],[127,14,102,19],[127,16,102,21],[127,20,102,25],[128,8,102,27,"error"],[128,13,102,32],[128,15,102,34,"error"],[128,20,102,39],[128,21,102,40,"message"],[129,6,102,48],[129,7,102,49],[130,4,103,2],[131,2,104,0],[132,0,104,1],[132,3]],"functionMap":{"names":["<global>","generateHMAC","generateIdempotencyKey","trackPurchase","trackCTA","trackImpression"],"mappings":"AAA;ACI;CDI;AEG;CFG;OGE;CH+B;OIE;CJ0B;OKE"},"hasCjsExports":false},"type":"js/module"}]}